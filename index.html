<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok é£æ ¼è§†é¢‘ç«™</title>
    
     <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: black; color: white; font-family: Arial, sans-serif; overflow: hidden; }
       .video-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    background: black;
}

video {
    width: 100vw;
    height: 100vh;
    object-fit: cover; /* è®©è§†é¢‘å¡«å……æ•´ä¸ªå±å¹•ï¼Œä¸å˜å½¢ */
}

        .bottom-bar { position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around; padding: 10px 0; background: rgba(0, 0, 0, 0.5); }
        .bottom-bar button { background: none; border: none; color: white; font-size: 18px; cursor: pointer; }
        .menu { position: fixed; top: 10px; right: 10px; cursor: pointer; }
        .menu div { width: 30px; height: 4px; background: white; margin: 5px 0; }
        .nav { display: none; position: fixed; top: 0; right: 0; width: 200px; height: 100vh; background: rgba(0, 0, 0, 0.8); padding: 20px; }
        .nav a { display: block; color: white; text-decoration: none; margin: 10px 0; }
        .video-info { position: absolute; bottom: 70px; left: 10px; }
        .video-info p { margin: 5px 0; }
        
        .nav {
    display: none;
    position: fixed;
    top: 0;
    right: 0;
    width: 200px;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    padding: 20px;
}
.nav.active {
    display: block;
}

#searchContainer {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    padding: 15px;
    border-radius: 10px;
    display: none; /* é»˜è®¤éšè— */
    z-index: 1000;
}
#searchInput {
    width: 200px;
    padding: 5px;
}
#searchButton {
    margin-left: 5px;
    cursor: pointer;
}

 @media (max-width: 768px) {
    video {
        height: 100vh;
        width: auto; /* è®©è§†é¢‘åœ¨ç§»åŠ¨ç«¯ä¿æŒåŸæ¯”ä¾‹ */
    }
}

#progressBar {
    position: fixed;
    bottom: 50px; /* âœ… è®©è¿›åº¦æ¡ç´§è´´åº•éƒ¨æ§åˆ¶æ  */
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    height: 5px;
    background: #ccc;
    border-radius: 5px;
    outline: none;
    appearance: none;
    z-index: 1000; /* âœ… ç¡®ä¿è¿›åº¦æ¡ä¸ä¼šè¢«é®æŒ¡ */
}
#progressBar::-webkit-slider-thumb {
    width: 12px;
    height: 12px;
    background: red;
    border-radius: 50%;
    cursor: pointer;
    appearance: none;
}
        

    </style>
</head>
<body>

<div class="video-container">
    <video id="video" autoplay loop muted playsinline></video>
    <input type="range" id="progressBar" value="0" min="0" max="100" step="0.1">
</div>


    <div class="video-info">
        <p id="username">@ç”¨æˆ·å</p>
        <p id="tags">#æ ‡ç­¾</p>
    </div>

<div id="searchContainer">
    <input type="text" id="searchInput" placeholder="æœç´¢ç”¨æˆ·åæˆ–æ ‡ç­¾">
    <button id="searchButton">æœç´¢</button>
</div>


   <script>
let videos = [];
let filteredVideos = []; // å­˜å‚¨æœç´¢ç»“æœ

async function loadVideos() {
    try {
        let response = await fetch('videos/videos.json');
        videos = await response.json();
        filteredVideos = [...videos]; // é»˜è®¤æ’­æ”¾æ‰€æœ‰è§†é¢‘
        playRandomVideo();
    } catch (error) {
        console.error("åŠ è½½è§†é¢‘åˆ—è¡¨å¤±è´¥:", error);
    }
}

function playRandomVideo() {
    if (filteredVideos.length === 0) {
        alert("æœªæ‰¾åˆ°ç›¸å…³è§†é¢‘");
        return;
    }

    let randomIndex = Math.floor(Math.random() * filteredVideos.length);
    let data = filteredVideos[randomIndex];
    let videoElement = document.getElementById("video");
    let videoUrl = data.videoUrl;

    console.log("æ­£åœ¨æ’­æ”¾è§†é¢‘ï¼š", videoUrl);

    // æ¸…é™¤ä¹‹å‰çš„ Hls.js å®ä¾‹ï¼Œé˜²æ­¢å†²çª
    if (videoElement.hlsInstance) {
        videoElement.hlsInstance.destroy();
        videoElement.hlsInstance = null;
    }

    if (videoUrl.endsWith(".m3u8")) {
        if (Hls.isSupported()) {
            let hls = new Hls();
            hls.loadSource(videoUrl);
            hls.attachMedia(videoElement);
            videoElement.hlsInstance = hls;
        } else {
            console.error("âŒ ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ M3U8 æ’­æ”¾ï¼");
            return;
        }
    } else {
        videoElement.src = videoUrl;
        videoElement.play(); // âœ… ç¡®ä¿ MP4 ä¹Ÿèƒ½è‡ªåŠ¨æ’­æ”¾
    }

    document.getElementById("username").innerText = "@" + data.username;
    document.getElementById("tags").innerText = data.tags.join(" ");
}



function searchVideos() {
    let query = document.getElementById("searchInput").value.trim().toLowerCase();
    if (query === "") {
        filteredVideos = [...videos]; // æ˜¾ç¤ºæ‰€æœ‰è§†é¢‘
    } else {
        filteredVideos = videos.filter(video =>
            video.username.toLowerCase().includes(query) ||
            video.tags.some(tag => tag.toLowerCase().includes(query))
        );
    }
    playRandomVideo(); // é‡æ–°æ’­æ”¾æœç´¢åçš„ç»“æœ
}

// ä¸»é¡µæŒ‰é’®ç‚¹å‡»äº‹ä»¶
function goHome() {
    window.location.href = "index.html"; // è¿”å›é¦–é¡µ
}

// å³ä¸Šè§’èœå•åˆ‡æ¢
function toggleMenu() {
    let nav = document.getElementById("nav");
    nav.classList.toggle("active");
}

// PC ç«¯é¼ æ ‡æ»šè½®äº‹ä»¶
document.addEventListener("wheel", (event) => {
    if (event.deltaY > 10 || event.deltaY < -10) {
        playRandomVideo();
    }
});

// è§¦æ‘¸æ»‘åŠ¨äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
let touchStartY = 0;
document.addEventListener("touchstart", (evt) => {
    touchStartY = evt.touches[0].clientY;
}, false);

document.addEventListener("touchend", (evt) => {
    let touchEndY = evt.changedTouches[0].clientY;
    if (Math.abs(touchStartY - touchEndY) > 10) {
        playRandomVideo();
    }
}, false);

document.addEventListener("DOMContentLoaded", function () {
    loadVideos(); // âœ… åªè°ƒç”¨ä¸€æ¬¡ loadVideos()

    const progressBar = document.getElementById("progressBar");
    const video = document.getElementById("video");

    // ç›‘å¬è§†é¢‘æ’­æ”¾è¿›åº¦ï¼Œæ›´æ–°è¿›åº¦æ¡
    video.addEventListener("timeupdate", function () {
        let progress = (video.currentTime / video.duration) * 100;
        progressBar.value = progress;
    });

    // ç›‘å¬è¿›åº¦æ¡æ‹–åŠ¨ï¼Œè·³è½¬åˆ°å¯¹åº”æ—¶é—´
    progressBar.addEventListener("input", function () {
        let seekTime = (progressBar.value / 100) * video.duration;
        video.currentTime = seekTime;
    });

    // âœ… ä¿®æ­£æœç´¢æŒ‰é’®çš„é—®é¢˜
    const searchContainer = document.getElementById("searchContainer");
    const searchInput = document.getElementById("searchInput");
    const searchButton = document.getElementById("searchButton");
    const searchIcon = document.getElementById("searchIcon"); // âœ… è¿™é‡Œå®šä¹‰ï¼Œç¡®ä¿ HTML åŠ è½½å®Œæˆåè·å–

    if (!searchContainer || !searchInput || !searchButton || !searchIcon) {
        console.error("âŒ æœç´¢æ¡†æˆ–æŒ‰é’®æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥ HTML ç»“æ„");
        return;
    }

    // ç‚¹å‡»åº•éƒ¨ğŸ”æŒ‰é’®ï¼Œæ˜¾ç¤ºæœç´¢æ¡†
    searchIcon.addEventListener("click", function () {
        console.log("ğŸ” æŒ‰é’®è¢«ç‚¹å‡»ï¼Œå°è¯•æ˜¾ç¤ºæœç´¢æ¡†");
        searchContainer.style.display = "block";
        searchInput.focus();
    });

    // ç›‘å¬ Enter è§¦å‘æœç´¢
    searchInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            searchVideos();
            closeSearch();
        }
    });

    // ç‚¹å‡»æœç´¢æŒ‰é’®è§¦å‘æœç´¢
    searchButton.addEventListener("click", function () {
        searchVideos();
        closeSearch();
    });

    // å…³é—­æœç´¢æ¡†
    function closeSearch() {
        searchContainer.style.display = "none";
    }

    // ç‚¹å‡»æœç´¢æ¡†å¤–éƒ¨å…³é—­
    document.addEventListener("click", function (event) {
        if (!searchContainer.contains(event.target) && event.target !== searchIcon) {
            closeSearch();
        }
    });
});

// â¸ï¸ æ’­æ”¾ / æš‚åœ è§†é¢‘
function togglePlay() {
    let video = document.getElementById("video");
    if (video.paused) {
        video.play();
    } else {
        video.pause();
    }
}

// ğŸ”Š é™éŸ³ / å–æ¶ˆé™éŸ³
function toggleSound() {
    let video = document.getElementById("video");
    video.muted = !video.muted;
}


</script>

    <div class="bottom-bar">
        <button onclick="goHome()">ğŸ </button>
        <button id="searchIcon">ğŸ”</button>
        <button onclick="togglePlay()">â¸ï¸</button>
        <button onclick="toggleSound()">ğŸ”Š</button>
    </div>
    <div class="menu" onclick="toggleMenu()">
        <div></div>
        <div></div>
        <div></div>
    </div>
    <div class="nav" id="nav">
        <a href="index.html">é¦–é¡µ</a>
        <a href="#">æ ‡ç­¾</a>
        <a href="#">è”ç³»æˆ‘ä»¬</a>
        <a href="#">æœåŠ¡æ¡æ¬¾</a>
    </div>
   
</body>
</html>
